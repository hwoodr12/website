---
title: "SQL"
output: html_document
---

## Filtering columns and rows

With SQL, you can filter columns and rows by using Select and where. Let's look at an example using Lahman database.

```{r,message=FALSE,warning=FALSE}
library(Lahman)

library(sqldf)
```


Supose now  I would like to see the homerun totals for the 1927 Yankees. I could write the following query:

```{r}
query <-"select playerID,yearID,teamID,hr from Batting
WHERE teamID='NYA' and yearID=1927"
sqldf(query)
```
##Phillies batting from 1770

```{r}
query <-"SELECT playerID,yearID,teamID,HR FROM Batting
WHERE teamID='PHI' and HR>30 and yearID<=1979 and yearID>=1970"

sqldf(query)
```


## Order By

with SQL, you can order the rows of your output. For instance,suppose you want to see every instance of a player hitting more than 50 homeruns. But you would like players with the most homeruns to be at the top. We could do the following:
```{r}
query <-"SELECT playerID,yearID,teamID,Hr FROM Batting
WHERE HR>50
ORDER BY HR DESC"
sqldf(query)
```

##Aggregation
Find Babe Ruth's Career homerun total;
```{r}
query<-"SELECT playerID, sum(HR) FROM Batting
WHERE playerID='ruthba01'
GROUP BY playerID"
sqldf(query)
```
Find Career totals for players having a sum more than 600 homeruns
```{r}
query<-"SELECT playerID, HR FROM Batting
GROUP BY playerID
HAVING sum(HR)>=600
ORDER BY sum(HR)DESC"
sqldf(query)
```
Find the players who have average more than 30 homeruns per year
```{r}
query<-"SELECT playerID,avg(HR) FROM Batting
GROUP BY playerID
HAVING avg(HR)>=30
ORDER BY avg(HR)DESC"
sqldf(query)
```


